class DemoManager{constructor(e){this.app=e,this.init()}static shouldInitialize(){return window.location.hostname.includes("railway.app")||window.location.hostname.includes("herokuapp.com")||window.location.hostname.includes("netlify.app")||window.location.hostname.includes("vercel.app")}init(){this.checkForWelcomeModal(),this.startNotificationPolling()}async handleDemoReset(){this.showResetDemoModal()}showResetDemoModal(){let e=document.getElementById("resetDemoModal");e||(e=document.createElement("div"),e.id="resetDemoModal",e.className="modal",e.innerHTML='\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Reset Demo</h2>\n                        <span class="close" id="resetModalClose">&times;</span>\n                    </div>\n                    <div class="modal-body">\n                        <h3>Are you sure you want to reset the demo?</h3>\n                        <div class="reset-info">\n                            <p><strong>This will:</strong></p>\n                            <ul>\n                                <li>Restore password to <code>admin123</code></li>\n                                <li>Replace all data with sample albums</li>\n                                <li>Log out all current users</li>\n                            </ul>\n                            <p class="warning">This action cannot be undone.</p>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-secondary" id="resetCancelBtn">Cancel</button>\n                        <button type="button" class="btn btn-danger" id="resetConfirmBtn">Reset Demo</button>\n                    </div>\n                </div>\n            ',document.body.appendChild(e),document.getElementById("resetModalClose").addEventListener("click",()=>{e.style.display="none"}),document.getElementById("resetCancelBtn").addEventListener("click",()=>{e.style.display="none"}),document.getElementById("resetConfirmBtn").addEventListener("click",()=>{this.confirmResetDemo(),e.style.display="none"}),e.addEventListener("click",t=>{t.target===e&&(e.style.display="none")})),e.style.display="block"}async confirmResetDemo(){try{const e=await fetch("api/music_api.php?action=reset_demo",{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok){const t=await e.json();t.success?(this.app.showMessage("Demo reset successfully! Password restored to admin123 and sample data loaded.","success"),window.location.reload()):this.app.showMessage("Failed to reset demo: "+t.message,"error")}else this.app.showMessage("Failed to reset demo. Please try again.","error")}catch(e){console.error("Error resetting demo:",e),this.app.showMessage("Failed to reset demo. Please try again.","error")}}showDemoResetSuccessModal(e){let t=document.getElementById("demoResetSuccessModal");t||(t=document.createElement("div"),t.id="demoResetSuccessModal",t.className="modal",t.innerHTML='\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Demo Reset Complete</h2>\n                        <span class="close" id="demoSuccessModalClose">&times;</span>\n                    </div>\n                    <div class="modal-body">\n                        <div class="success-info">\n                            <p><strong>Demo has been successfully reset!</strong></p>\n                            <ul>\n                                <li>Password restored to <code>admin123</code></li>\n                                <li>Sample data refreshed with demo albums</li>\n                                <li>All users have been logged out</li>\n                            </ul>\n                            <p class="info">Click "Continue" to reload the page and see the changes.</p>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-primary" id="demoSuccessContinueBtn">Continue</button>\n                    </div>\n                </div>\n            ',document.body.appendChild(t),document.getElementById("demoSuccessModalClose").addEventListener("click",()=>{this.handleDemoResetSuccess()}),document.getElementById("demoSuccessContinueBtn").addEventListener("click",()=>{this.handleDemoResetSuccess()}),t.addEventListener("click",e=>{e.target===t&&this.handleDemoResetSuccess()})),t.style.display="block"}handleDemoResetSuccess(){fetch("api/music_api.php?action=logout",{method:"POST",headers:{"Content-Type":"application/json"}}).then(()=>{window.location.reload()}).catch(()=>{window.location.reload()})}checkForWelcomeModal(){if(window.location.hostname.includes("railway.app")||window.location.hostname.includes("herokuapp.com")||window.location.hostname.includes("netlify.app")||window.location.hostname.includes("vercel.app")){localStorage.getItem("hasSeenWelcomeModal")||setTimeout(()=>{this.showWelcomeModal()},1e3)}}showWelcomeModal(){let e=document.getElementById("welcomeModal");e||(e=document.createElement("div"),e.id="welcomeModal",e.className="modal",e.innerHTML='\n                <div class="modal-content welcome-modal-content">\n                    <div class="modal-header">\n                        <h2>Welcome to Music Collection Manager Demo</h2>\n                        <span class="close" id="welcomeModalClose">&times;</span>\n                    </div>\n                    <div class="modal-body">\n                        <div class="welcome-info">\n                            <div class="demo-features">\n                                <h3>Getting Started</h3>\n                                <ul>\n                                    <li><strong>Login:</strong> Use password <code>admin123</code> to access editing features</li>\n                                    <li><strong>Add/Edit/Delete Albums:</strong> Add new albums; edit and delete existing albums</li>\n                                </ul>\n                                \n                                <h3>Features to Try</h3>\n                                <ul>\n                                    <li><strong>Search & Filter:</strong> Use the search bar and filter buttons</li>\n                                    <li><strong>Statistics:</strong> View collection analytics in the sidebar or the dropdown</li>\n                                    <li><strong>Settings:</strong> Click the gear icon to customize the interface</li>\n                                </ul>\n                                \n                                <h3>Demo Reset</h3>\n                                <ul>\n                                    <li><strong>Reset Demo:</strong> Use the "Reset Demo" button in settings to restore original data and the <code>admin123</code> password</li>\n                                </ul>\n                            </div>\n                            \n                            <div class="demo-note">\n                                <p><strong>Note:</strong> This is a shared demo environment. Other users may be using it simultaneously, so changes might be reset by other visitors.</p>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-primary" id="welcomeGotItBtn">Got it, let\'s start!</button>\n                    </div>\n                </div>\n            ',document.body.appendChild(e),document.getElementById("welcomeModalClose").addEventListener("click",()=>{this.closeWelcomeModal()}),document.getElementById("welcomeGotItBtn").addEventListener("click",()=>{this.closeWelcomeModal()}),e.addEventListener("click",t=>{t.target===e&&this.closeWelcomeModal()})),e.style.display="block"}closeWelcomeModal(){localStorage.setItem("hasSeenWelcomeModal","true");const e=document.getElementById("welcomeModal");e&&(e.style.display="none")}startNotificationPolling(){localStorage.getItem("browserId")||localStorage.setItem("browserId","browser_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)),this.browserId=localStorage.getItem("browserId"),setInterval(()=>{this.checkForNotifications()},1e4),setTimeout(()=>{this.checkForNotifications()},2e3)}async checkForNotifications(){try{const e=await fetch("api/music_api.php?action=get_notifications");if(e.ok){const t=await e.json();t.success&&t.notifications&&t.notifications.length>0&&this.showNotifications(t.notifications)}}catch(e){}}showNotifications(e){const t="shownNotifications_"+this.browserId,o=JSON.parse(localStorage.getItem(t)||"[]");o.length>50&&(o.splice(0,o.length-50),localStorage.setItem(t,JSON.stringify(o)));const n=e.map(e=>e.id);document.querySelectorAll(".notification-toast").forEach(e=>{const t=parseInt(e.dataset.notificationId);n.includes(t)||e.remove()}),e.forEach(e=>{o.includes(e.id)||(o.push(e.id),localStorage.setItem(t,JSON.stringify(o)),this.showNotificationToast(e))})}showNotificationToast(e){this.handleDemoResetNotification(e)}handleDemoResetNotification(e){this.showDemoResetSuccessModal(e)}}window.DemoManager=DemoManager,document.addEventListener("DOMContentLoaded",function(){DemoManager.shouldInitialize()&&window.app&&(window.app.demoManager=new DemoManager(window.app))});